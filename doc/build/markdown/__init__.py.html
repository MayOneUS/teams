<!DOCTYPE html>
<html>
<head>
  <title>__init__.py</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../", thisFile = "build/markdown/__init__.py", defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#basic%20usage%20as%20a%20module%3A">Basic usage as a module:</a>
      </div>
      <div class="heading h1">
        <a href="#authors%20and%20license">Authors and License</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>__init__.py</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Python Markdown</span>
<span class="sd">===============</span>

<span class="sd">Python Markdown converts Markdown to HTML and can be used as a library or</span>
<span class="sd">called from the command line.</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="basic%20usage%20as%20a%20module%3A">
  <h1>
    <a href="#basic%20usage%20as%20a%20module%3A" name="basic%20usage%20as%20a%20module%3A" class="pilcrow">&#182;</a>
    Basic usage as a module:
  </h1>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="sd">    import markdown</span>
<span class="sd">    html = markdown.markdown(your_text_string)</span>

<span class="sd">See &lt;http://packages.python.org/Markdown/&gt; for more</span>
<span class="sd">information and instructions on how to extend the functionality of</span>
<span class="sd">Python Markdown.  Read that before you try modifying this file.</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="authors%20and%20license">
  <h1>
    <a href="#authors%20and%20license" name="authors%20and%20license" class="pilcrow">&#182;</a>
    Authors and License
  </h1>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="sd">Started by [Manfred Stienstra](http://www.dwerg.net/).  Continued and</span>
<span class="sd">maintained  by [Yuri Takhteyev](http://www.freewisdom.org), [Waylan</span>
<span class="sd">Limberg](http://achinghead.com/) and [Artem Yunusov](http://blog.splyer.com).</span>

<span class="sd">Contact: markdown@freewisdom.org</span>

<span class="sd">Copyright 2007-2013 The Python Markdown Project (v. 1.7 and later)</span>
<span class="sd">Copyright 200? Django Software Foundation (OrderedDict implementation)</span>
<span class="sd">Copyright 2004, 2005, 2006 Yuri Takhteyev (v. 0.2-1.6b)</span>
<span class="sd">Copyright 2004 Manfred Stienstra (the original version)</span>

<span class="sd">License: BSD (see LICENSE for details).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>
<span class="kn">from</span> <span class="nn">.__version__</span> <span class="kn">import</span> <span class="n">version</span><span class="p">,</span> <span class="n">version_info</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">.preprocessors</span> <span class="kn">import</span> <span class="n">build_preprocessors</span>
<span class="kn">from</span> <span class="nn">.blockprocessors</span> <span class="kn">import</span> <span class="n">build_block_parser</span>
<span class="kn">from</span> <span class="nn">.treeprocessors</span> <span class="kn">import</span> <span class="n">build_treeprocessors</span>
<span class="kn">from</span> <span class="nn">.inlinepatterns</span> <span class="kn">import</span> <span class="n">build_inlinepatterns</span>
<span class="kn">from</span> <span class="nn">.postprocessors</span> <span class="kn">import</span> <span class="n">build_postprocessors</span>
<span class="kn">from</span> <span class="nn">.extensions</span> <span class="kn">import</span> <span class="n">Extension</span>
<span class="kn">from</span> <span class="nn">.serializers</span> <span class="kn">import</span> <span class="n">to_html_string</span><span class="p">,</span> <span class="n">to_xhtml_string</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Markdown&#39;</span><span class="p">,</span> <span class="s">&#39;markdown&#39;</span><span class="p">,</span> <span class="s">&#39;markdownFromFile&#39;</span><span class="p">]</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;MARKDOWN&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Markdown</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert Markdown to HTML.&quot;&quot;&quot;</span>

    <span class="n">doc_tag</span> <span class="o">=</span> <span class="s">&quot;div&quot;</span>     <span class="c"># Element used to wrap document - later removed</span>

    <span class="n">option_defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;html_replacement_text&#39;</span> <span class="p">:</span> <span class="s">&#39;[HTML_REMOVED]&#39;</span><span class="p">,</span>
        <span class="s">&#39;tab_length&#39;</span>            <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s">&#39;enable_attributes&#39;</span>     <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s">&#39;smart_emphasis&#39;</span>        <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s">&#39;lazy_ol&#39;</span>               <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">output_formats</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;html&#39;</span>  <span class="p">:</span> <span class="n">to_html_string</span><span class="p">,</span>
        <span class="s">&#39;html4&#39;</span> <span class="p">:</span> <span class="n">to_html_string</span><span class="p">,</span>
        <span class="s">&#39;html5&#39;</span> <span class="p">:</span> <span class="n">to_html_string</span><span class="p">,</span>
        <span class="s">&#39;xhtml&#39;</span> <span class="p">:</span> <span class="n">to_xhtml_string</span><span class="p">,</span>
        <span class="s">&#39;xhtml1&#39;</span><span class="p">:</span> <span class="n">to_xhtml_string</span><span class="p">,</span>
        <span class="s">&#39;xhtml5&#39;</span><span class="p">:</span> <span class="n">to_xhtml_string</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">ESCAPED_CHARS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;`&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="s">&#39;{&#39;</span><span class="p">,</span> <span class="s">&#39;}&#39;</span><span class="p">,</span> <span class="s">&#39;[&#39;</span><span class="p">,</span> <span class="s">&#39;]&#39;</span><span class="p">,</span>
                    <span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;!&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new Markdown instance.</span>

<span class="sd">        Keyword arguments:</span>

<span class="sd">        * extensions: A list of extensions.</span>
<span class="sd">           If they are of type string, the module mdx_name.py will be loaded.</span>
<span class="sd">           If they are a subclass of markdown.Extension, they will be used</span>
<span class="sd">           as-is.</span>
<span class="sd">        * extension_configs: Configuration settingis for extensions.</span>
<span class="sd">        * output_format: Format of output. Supported formats are:</span>
<span class="sd">            * &quot;xhtml1&quot;: Outputs XHTML 1.x. Default.</span>
<span class="sd">            * &quot;xhtml5&quot;: Outputs XHTML style tags of HTML 5</span>
<span class="sd">            * &quot;xhtml&quot;: Outputs latest supported version of XHTML (currently XHTML 1.1).</span>
<span class="sd">            * &quot;html4&quot;: Outputs HTML 4</span>
<span class="sd">            * &quot;html5&quot;: Outputs HTML style tags of HTML 5</span>
<span class="sd">            * &quot;html&quot;: Outputs latest supported version of HTML (currently HTML 4).</span>
<span class="sd">            Note that it is suggested that the more specific formats (&quot;xhtml1&quot;</span>
<span class="sd">            and &quot;html4&quot;) be used as &quot;xhtml&quot; or &quot;html&quot; may change in the future</span>
<span class="sd">            if it makes sense at that time.</span>
<span class="sd">        * safe_mode: Disallow raw html. One of &quot;remove&quot;, &quot;replace&quot; or &quot;escape&quot;.</span>
<span class="sd">        * html_replacement_text: Text used when safe_mode is set to &quot;replace&quot;.</span>
<span class="sd">        * tab_length: Length of tabs in the source. Default: 4</span>
<span class="sd">        * enable_attributes: Enable the conversion of attributes. Default: True</span>
<span class="sd">        * smart_emphasis: Treat `_connected_words_` intelligently Default: True</span>
<span class="sd">        * lazy_ol: Ignore number of first item of ordered lists. Default: True</span>

<span class="sd">        &quot;&quot;&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>For backward compatibility, loop through old positional args</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;extensions&#39;</span><span class="p">,</span> <span class="s">&#39;extension_configs&#39;</span><span class="p">,</span> <span class="s">&#39;safe_mode&#39;</span><span class="p">,</span> <span class="s">&#39;output_format&#39;</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pos</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">arg</span>
            <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<p>ignore any additional args</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="k">break</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>Loop through kwargs and assign defaults</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">for</span> <span class="n">option</span><span class="p">,</span> <span class="n">default</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">default</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">safeMode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;safe_mode&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">safeMode</span> <span class="ow">and</span> <span class="s">&#39;enable_attributes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>Disable attributes in safeMode when not explicitly set</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_attributes</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">registeredExtensions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">docType</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stripTopLevelTags</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">build_parser</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">references</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">htmlStash</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">HtmlStash</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registerExtensions</span><span class="p">(</span><span class="n">extensions</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;extensions&#39;</span><span class="p">,</span> <span class="p">[]),</span>
                                <span class="n">configs</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;extension_configs&#39;</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_output_format</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;output_format&#39;</span><span class="p">,</span> <span class="s">&#39;xhtml1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">build_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Build the parser from the various parts. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessors</span> <span class="o">=</span> <span class="n">build_preprocessors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">build_block_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inlinePatterns</span> <span class="o">=</span> <span class="n">build_inlinepatterns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeprocessors</span> <span class="o">=</span> <span class="n">build_treeprocessors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postprocessors</span> <span class="o">=</span> <span class="n">build_postprocessors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">registerExtensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extensions</span><span class="p">,</span> <span class="n">configs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register extensions with this instance of Markdown.</span>

<span class="sd">        Keyword arguments:</span>

<span class="sd">        * extensions: A list of extensions, which can either</span>
<span class="sd">           be strings or objects.  See the docstring on Markdown.</span>
<span class="sd">        * configs: A dictionary mapping module names to config options.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">string_type</span><span class="p">):</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_extension</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="p">[]))</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">Extension</span><span class="p">):</span>
                <span class="n">ext</span><span class="o">.</span><span class="n">extendMarkdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">ext</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s">&#39;Extension &quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot; must be of type: &quot;markdown.Extension&quot;&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="n">ext</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">build_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ext_name</span><span class="p">,</span> <span class="n">configs</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Build extension by name, then return the module.</span>

<span class="sd">        The extension name may contain arguments as part of the string in the</span>
<span class="sd">        following format: &quot;extname(key1=value1,key2=value2)&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>Parse extensions config params (ignore the order)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="n">configs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">ext_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;(&quot;</span><span class="p">)</span> <span class="c"># find the first &quot;(&quot;</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ext_args</span> <span class="o">=</span> <span class="n">ext_name</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ext_name</span> <span class="o">=</span> <span class="n">ext_name</span><span class="p">[:</span><span class="n">pos</span><span class="p">]</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;=&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ext_args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)]</span>
            <span class="n">configs</span><span class="o">.</span><span class="n">update</span><span class="p">([(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">])</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>Setup the module name</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="n">module_name</span> <span class="o">=</span> <span class="n">ext_name</span>
        <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ext_name</span><span class="p">:</span>
            <span class="n">module_name</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;markdown.extensions&#39;</span><span class="p">,</span> <span class="n">ext_name</span><span class="p">])</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>Try loading the extension first from one place, then another</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">try</span><span class="p">:</span> <span class="c"># New style (markdown.extensions.&lt;extension&gt;)</span>
            <span class="n">module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">[</span><span class="n">module_name</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="n">module_name_old_style</span> <span class="o">=</span> <span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;mdx&#39;</span><span class="p">,</span> <span class="n">ext_name</span><span class="p">])</span>
            <span class="k">try</span><span class="p">:</span> <span class="c"># Old style (mdx_&lt;extension&gt;)</span>
                <span class="n">module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">module_name_old_style</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Failed loading extension &#39;</span><span class="si">%s</span><span class="s">&#39; from &#39;</span><span class="si">%s</span><span class="s">&#39; or &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> \
                    <span class="o">%</span> <span class="p">(</span><span class="n">ext_name</span><span class="p">,</span> <span class="n">module_name</span><span class="p">,</span> <span class="n">module_name_old_style</span><span class="p">)</span>
                <span class="n">e</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">message</span><span class="p">,)</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">raise</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>If the module is loaded successfully, we expect it to define a
function called makeExtension()</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">module</span><span class="o">.</span><span class="n">makeExtension</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Failed to initiate extension &quot;</span> \
                      <span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39;: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ext_name</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
            <span class="n">e</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">message</span><span class="p">,)</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">registerExtension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extension</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This gets called by the extension &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registeredExtensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets all state variables so that we can start with a new text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">htmlStash</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">extension</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">registeredExtensions</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">extension</span><span class="p">,</span> <span class="s">&#39;reset&#39;</span><span class="p">):</span>
                <span class="n">extension</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">set_output_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the output format for the class instance. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_format</span> <span class="o">=</span> <span class="n">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">serializer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_formats</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">output_format</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">valid_formats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_formats</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">valid_formats</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s">&#39;Invalid Output Format: &quot;</span><span class="si">%s</span><span class="s">&quot;. Use one of </span><span class="si">%s</span><span class="s">.&#39;</span> \
                       <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_format</span><span class="p">,</span> 
                          <span class="s">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="s">&#39;&quot;, &quot;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">valid_formats</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
            <span class="n">e</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">message</span><span class="p">,)</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert markdown to serialized XHTML or HTML.</span>

<span class="sd">        Keyword arguments:</span>

<span class="sd">        * source: Source text as a Unicode string.</span>

<span class="sd">        Markdown processing takes place in five steps:</span>

<span class="sd">        1. A bunch of &quot;preprocessors&quot; munge the input text.</span>
<span class="sd">        2. BlockParser() parses the high-level structural elements of the</span>
<span class="sd">           pre-processed text into an ElementTree.</span>
<span class="sd">        3. A bunch of &quot;treeprocessors&quot; are run against the ElementTree. One</span>
<span class="sd">           such treeprocessor runs InlinePatterns against the ElementTree,</span>
<span class="sd">           detecting inline markup.</span>
<span class="sd">        4. Some post-processors are run against the text after the ElementTree</span>
<span class="sd">           has been serialized into text.</span>
<span class="sd">        5. The output is written to a string.</span>

<span class="sd">        &quot;&quot;&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>Fixup the source text</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">source</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span>  <span class="c"># a blank unicode string</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>Customise error message while maintaining original trackback</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="n">e</span><span class="o">.</span><span class="n">reason</span> <span class="o">+=</span> <span class="s">&#39;. -- Note: Markdown only accepts unicode input!&#39;</span>
            <span class="k">raise</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>Split into lines and run the line preprocessors.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">prep</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">prep</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>Parse the high-level elements.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parseDocument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>Run the tree-processors</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">for</span> <span class="n">treeprocessor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">treeprocessors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">newRoot</span> <span class="o">=</span> <span class="n">treeprocessor</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">newRoot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">newRoot</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>Serialize <em>properly</em>.  Strip top-level tags.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serializer</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stripTopLevelTags</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;&lt;</span><span class="si">%s</span><span class="s">&gt;&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_tag</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_tag</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">rindex</span><span class="p">(</span><span class="s">&#39;&lt;/</span><span class="si">%s</span><span class="s">&gt;&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_tag</span><span class="p">)</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;&lt;</span><span class="si">%s</span><span class="s"> /&gt;&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_tag</span><span class="p">):</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>We have an empty document</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                    <span class="n">output</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">else</span><span class="p">:</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>We have a serious problem</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Markdown failed to strip top-level tags. Document=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">output</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>Run the text post-processors</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocessors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">convertFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts a markdown file and returns the HTML as a unicode string.</span>

<span class="sd">        Decodes the file using the provided encoding (defaults to utf-8),</span>
<span class="sd">        passes the file content to markdown, and outputs the html to either</span>
<span class="sd">        the provided stream or the file with provided name, using the same</span>
<span class="sd">        encoding as the source file. The &#39;xmlcharrefreplace&#39; error handler is</span>
<span class="sd">        used when encoding the output.</span>

<span class="sd">        **Note:** This is the only place that decoding and encoding of unicode</span>
<span class="sd">        takes place in Python-Markdown.  (All other code is unicode-in /</span>
<span class="sd">        unicode-out.)</span>

<span class="sd">        Keyword arguments:</span>

<span class="sd">        * input: File object or path. Reads from stdin if `None`.</span>
<span class="sd">        * output: File object or path. Writes to stdout if `None`.</span>
<span class="sd">        * encoding: Encoding of input and output files. Defaults to utf-8.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span> <span class="ow">or</span> <span class="s">&quot;utf-8&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>Read the source</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="nb">input</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">string_type</span><span class="p">):</span>
                <span class="n">input_file</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">input_file</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="n">encoding</span><span class="p">)(</span><span class="nb">input</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">input_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">text_type</span><span class="p">):</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\ufeff</span><span class="s">&#39;</span><span class="p">)</span> <span class="c"># remove the byte-order mark</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>Convert</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>Write to file or stdout</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">string_type</span><span class="p">):</span>
                <span class="n">output_file</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span>
                                          <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
                                          <span class="n">errors</span><span class="o">=</span><span class="s">&quot;xmlcharrefreplace&quot;</span><span class="p">)</span>
                <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
                <span class="n">output_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">writer</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
                <span class="n">output_file</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">&quot;xmlcharrefreplace&quot;</span><span class="p">)</span>
                <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<p>Don't close here. User may want to write more.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">else</span><span class="p">:</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<p>Encode manually and write bytes to stdout. </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="s">&quot;xmlcharrefreplace&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<p>Write bytes directly to buffer (Python 3).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>Probably Python 2, which works with bytes by default.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">EXPORTED FUNCTIONS</span>
<span class="sd">=============================================================================</span>

<span class="sd">Those are the two functions we really mean to export: markdown() and</span>
<span class="sd">markdownFromFile().</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">markdown</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a markdown string to HTML and return HTML as a unicode string.</span>

<span class="sd">    This is a shortcut function for `Markdown` class to cover the most</span>
<span class="sd">    basic use case.  It initializes an instance of Markdown, loads the</span>
<span class="sd">    necessary extensions and runs the parser on the given text.</span>

<span class="sd">    Keyword arguments:</span>

<span class="sd">    * text: Markdown formatted text as Unicode or ASCII string.</span>
<span class="sd">    * Any arguments accepted by the Markdown class.</span>

<span class="sd">    Returns: An HTML document as a string.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">md</span> <span class="o">=</span> <span class="n">Markdown</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">markdownFromFile</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read markdown code from a file and write it to a file or a stream.</span>

<span class="sd">    This is a shortcut function which initializes an instance of Markdown,</span>
<span class="sd">    and calls the convertFile method rather than convert.</span>

<span class="sd">    Keyword arguments:</span>

<span class="sd">    * input: a file name or readable object.</span>
<span class="sd">    * output: a file name or writable object.</span>
<span class="sd">    * encoding: Encoding of input and output.</span>
<span class="sd">    * Any arguments accepted by the Markdown class.</span>

<span class="sd">    &quot;&quot;&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>For backward compatibility loop through positional args</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">,</span> <span class="s">&#39;output&#39;</span><span class="p">,</span> <span class="s">&#39;extensions&#39;</span><span class="p">,</span> <span class="s">&#39;encoding&#39;</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pos</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">arg</span>
        <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
            <span class="k">break</span>

    <span class="n">md</span> <span class="o">=</span> <span class="n">Markdown</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">md</span><span class="o">.</span><span class="n">convertFile</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;input&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                   <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;output&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                   <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;encoding&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
